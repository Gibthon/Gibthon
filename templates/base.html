<!DOCTYPE HTML>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Gibthon:{{ title|default:"Home" }}</title>
<link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}/css/jquery-ui-redmond.css" />
<link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}/css/base.css" />
{% block css-include %}{% endblock %}
<script src="{{ STATIC_URL }}/js/jquery.min.js" type="text/javascript"></script>
<script src="{{ STATIC_URL }}/js/jquery-ui.min.js" type="text/javascript"></script>
<script src="{{ STATIC_URL }}/js/ajax.js" type="text/javascript"></script>
{% block js-include %}{% endblock %}
{% block js %}{% endblock %}
{% if user.is_authenticated %}
<script src='http://async-message-passer.appspot.com/_ah/channel/jsapi'></script>
{% endif %}
<script type="text/javascript">
$(document).ready(function() {
	$('button#login')
		.button({
			icons:{primary:'ui-icon-tag'}
		})
		.click(function() {
			window.location.href = '/user/login?next='+window.location.pathname;
		});
	$('button#logout')
		.button({
			icons:{primary:'ui-icon-tag'}
		})
		.click(function() {
			window.location.href = '/user/logout';
		});
	$('button#register')
		.button({
			icons:{primary:'ui-icon-key'}
		})
		.click(function() {
			window.location.href = '/user/register/';
		});
	$('button#back')
		.button({
			icons:{primary:'ui-icon-arrowthick-1-w'}
		})
		.click(function() {
			history.go(-1);
		});
	$('button#forward')
		.button({
			icons:{secondary:'ui-icon-arrowthick-1-e'}
		})
		.click(function() {
			history.go(1);
		});
	var re = /(\/(\d+\/)?[\w_ ]+)+/;
	var m = re.exec(window.location.pathname);
	if(m){
		$('a#up').attr('href', (m[0] == m[1]) ? '/' : m[0].replace(m[1],'') + '/');
	}
	$('a#up')
		.button({
			icons:{primary:'ui-icon-arrowreturnthick-1-n'}
		});
	$('a[id^="menu"]').button();
	
	$('input[id^="id_captcha"]').addClass('captcha');
	{% if user.is_authenticated %}
		channel = new goog.appengine.Channel('{{ user.channel_key }}');
		socket = channel.open();
		socket.onopen = function() {};
		socket.onmessage = function(message) {
			$.get('/user/inbox/fetch', function (data) {
				if(data[0] > 0){
					$('span#not_added').html(data[2]);
					$('span#unread').html(data[1]);
					alert('You have '+data[0]+' new message(s)!');
				}
			}, 'json');
		};
		socket.onerror = function() {};
		socket.onclose = function() {};	
	{% endif %}
	
});
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-18410656-4']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
</head>

<body>

<div class="container">
	<div class="ui-widget-header ui-corner-all" style="height:70px; margin-bottom:10px;">
		{% if user.is_authenticated %}
		<div style="float:right; margin:10px;">
			<h4 style="line-height:50px; font-size:0.8em;">Logged in as {{ user }}</h4>
		</div>
		{% endif %}
		<a href="/"><img src="{{ STATIC_URL }}/images/gibthon2.0beta.png" style="height:60px; padding:5px 10px; float:left;" alt="Gibthon" /></a>
		<h2 style="line-height:70px;">Gibthon:<span style="font-size:0.7em">{{ title|default:"Home" }}</span></h2>
	</div>
	<div id="menu_wrap" style="width:170px; float:left;">
		<div class="ui-widget-content ui-corner-all menu">
			<p><strong>Navigation</strong></p>
			<a id="menu_home" href="/">Home</a>
			{% if user.is_authenticated %}
			<a id="menu_profile" href="/user/profile/">Profile</a>
			<a id="menu_inbox" href="/user/inbox/">Inbox (<span id="unread" style="color:red;">{{ user.inbox.unread.count }}</span>/<span id="not_added" style="color:black;">{{ user.inbox.not_added.count }}</span>/<span id="count">{{ user.inbox.message.count }})</a>
			{% endif %}
			<p><strong>Gibthon</strong></p>
			<a id="menu_fragment" href="/fragment/">Fragment library</a>
			<a id="menu_gibthon" href="/gibthon/">Construct Designer</a>
			<p><strong>Other Tools</strong></p>
			<a href="/tools/ligcalc/" id="menu_tools_ligate">LigCalc</a>
			<a href="/tools/molcalc/" id="menu_tools_molcal">MolCalc</a>
			<p><strong>Help</strong></p>
			<a href="/help/gibson/" id="menu_help_gibson">Gibson Assembly</a>
			<a href="/help/primer/" id="menu_help_primer">Primer Design</a>
			<a href="/help/gibthon/" id="menu_help_gibthon">Construct Designer</a>
			<a href="/partsearch/" id="menu_help_api">PartSearch API</a>
		</div>
	</div>
	<div class="ui-widget-content ui-corner-all content" style="margin-top:-6px;">
		<button id="back">Back</button>
		<a href="#" id="up">Up</a>
		<button id="forward">Forward</button>
		{% block menu %}
		{% endblock %}
		{% if user.is_authenticated %}
			<button style="float:right;" id="logout">Log out</button>
		{% else %}
			<button style="float:right;" id="login">Log in</button>
			<button style="float:right; margin-right:5px;" id="register">Register</button>
		{% endif %}
	</div>
	{% block login_prompt %}
	{% if user.is_authenticated %}
	{% else %}
	<div class="ui-state-highlight ui-corner-all content">
	<p>Want to have a play around? Just <a href="/user/login">login</a> with the username 'demo' and password 'demo'. Nothing is guaranteed to work, but please email any problems you do find to <a href="mailto:bill@gibthon.org">me</a></p>
	</div>
	{% endif %}
	{% endblock %}
		{% block content %}{% endblock %}
	<div class="ui-widget-content ui-corner-all footer">
		Copyright 2011 Bill Collins and Contributors
	</div>
</div>

{% block dialog %}
{% endblock %}
</body>
</html>
