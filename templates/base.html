<!DOCTYPE HTML>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Gibthon:{{ title|default:"Home" }}</title>
<link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}/css/jquery-ui-redmond.css" />
<link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}/css/base.css" />
{% block css-include %}{% endblock %}
<script src="{{ STATIC_URL }}/js/jquery.min.js" type="text/javascript"></script>
<script src="{{ STATIC_URL }}/js/jquery-ui.min.js" type="text/javascript"></script>
<script src="{{ STATIC_URL }}/js/ajax.js" type="text/javascript"></script>
<script src="{{ STATIC_URL }}/js/jquery.prompt.js" type="text/javascript"></script>
<script src="{{ STATIC_URL }}/js/jquery.easing.js" type="text/javascript"></script>
<script src="{{ STATIC_URL }}/js/jquery.lavalamp.min.js" type="text/javascript"></script>
{% block js-include %}{% endblock %}
{% block js %}{% endblock %}
{% if user.is_authenticated %}
<script src='http://async-message-passer.appspot.com/_ah/channel/jsapi'></script>
{% endif %}
<script type="text/javascript">
var inbox_refresh = function() {
	$.get('/user/inbox/fetch', function (data) {
		$('span#inbox_not_added').html(data[2]);
		$('span#inbox_unread').html(data[1]);
		$('span#inbox_count').html(data[3]);
		if (data[0] > 0) {
			alert('You have '+data[0]+' new message(s)!');
		}
	}, 'json');
};
var STATIC_URL = "{{ STATIC_URL }}";
$(document).ready(function() {
	inbox_refresh();
	$('button#login')
		.button({
			icons:{primary:'ui-icon-tag'}
		})
		.click(function() {
			window.location.href = '/user/login?next='+window.location.pathname;
		});
	$('button#logout')
		.button({
			icons:{primary:'ui-icon-tag'}
		})
		.click(function() {
			window.location.href = '/user/logout';
		});
	$('button#register')
		.button({
			icons:{primary:'ui-icon-key'}
		})
		.click(function() {
			window.location.href = '/user/register/';
		});
	$('a[id^="menu"]').button();
			
	{% if user.is_authenticated %}
	$('#user_tab_profile').button({
		icons:{primary:'ui-icon-person'}
	});
	$('#user_tab_inbox').button({
		icons:{primary:'ui-icon-mail-closed'}
	});
	$('#user_tab_logout').button({
		icons:{primary:'ui-icon-tag'}
	});
	{% else %}
	$('#user_tab_login').button({
		icons:{primary:'ui-icon-tag'}
	})
	.click(function (event) {
		event.preventDefault();
		window.location.href="/user/login?next="+window.location.pathname;
	});
	$('#user_tab_register').button({
		icons:{primary:'ui-icon-key'}
	});
	{% endif %}

	$('.user_tab').addClass('ui-corner-top').removeClass('ui-corner-all');

	
	$('input[id^="id_captcha"]').addClass('captcha');
	{% if user.is_authenticated %}
		channel = new goog.appengine.Channel('{{ user.get_channel_key }}');
		socket = channel.open();
		socket.onopen = function() {};
		socket.onmessage = function(message) {
			inbox_refresh();
		};
		socket.onerror = function() {};
		socket.onclose = function() {};	
	{% endif %}
	
	$('a.menu_head').button().addClass('ui-corner-right').removeClass('ui-corner-all');
	//$('a.menu_sub').button();
	$('ul.menu_sub').lavaLamp();
	
});
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-18410656-4']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
</head>

<body>

<div class="container">
	<div class="ui-widget-header ui-corner-all" style="height:70px; margin-bottom:10px;">
		{% if user.is_authenticated %}
		<a href="/user/logout" id="user_tab_logout" class="user_tab">Log out</a>
		<a href="/user/inbox/" id="user_tab_inbox" class="user_tab">Inbox (<span id="inbox_unread" style="color:red;">&nbsp;&nbsp;</span>/<span id="inbox_not_added" style="color:black;">&nbsp;&nbsp;</span>/<span id="inbox_count">&nbsp;&nbsp;</span>)</a>
		<a href="/user/profile/" id="user_tab_profile" class="user_tab">Logged in as {{ user }}</a>
		{% else %}
		<a href="/user/login/" id="user_tab_login" class="user_tab">Log in</a>
		<a href="/user/register/" id="user_tab_register" class="user_tab">Register</a>
		{% endif %}
		<a href="/"><img src="{{ STATIC_URL }}/images/gibthon2.0beta.png" style="height:60px; padding:5px 10px; float:left;" alt="Gibthon" /></a>
		<h2 style="line-height:70px;">Gibthon:<span style="font-size:0.7em">{{ title|default:"Home" }}</span></h2>
	</div>
	<div id="menu_wrap" style="width:170px; float:left;">
		<div class="ui-widget-content ui-corner-all menu">
<!--
				<a class="menu_head">Home</a>
				<ul class="menu_sub">
					<li><a href="/" class="menu_sub">Home</a></li>
					<li><a href="/about/" class="menu_sub">About</a></li>
				</ul>
				<a class="menu_head">Tools</a>
				<ul class="menu_sub">
					<li><a href="/fragment/" class="menu_sub">Library</a></li>
					<li><a href="/gibthon/" class="menu_sub">Construct Designer</a></li>
					<li><a href="/tools/ligcalc/" class="menu_sub">LigCalc</a></li>
					<li><a href="/tools/molcalc/" class="menu_sub">MolCalc</a></li>
				</ul>
			-->
			<p><strong>Navigation</strong></p>
			<a id="menu_home" href="/">Home</a>
			<p><strong>Gibthon</strong></p>
			<a id="menu_fragment" href="/fragment/">Fragment library</a>
			<a id="menu_gibthon" href="/gibthon/">Construct Designer</a>
			<p><strong>Other Tools</strong></p>
			<a href="/tools/ligcalc/" id="menu_tools_ligate">LigCalc</a>
			<a href="/tools/molcalc/" id="menu_tools_molcal">MolCalc</a>
			<p><strong>Help</strong></p>
			<a href="/help/gibson/" id="menu_help_gibson">Gibson Assembly</a>
			<a href="/help/primer/" id="menu_help_primer">Primer Design</a>
			<a href="/help/gibthon/" id="menu_help_gibthon">Construct Designer</a>
			<a href="/partsearch/" id="menu_help_api">PartSearch API</a>
			
		</div>
	</div>
	{% block menu %}
	{% endblock %}
	
	{% block login_prompt %}
	{% if user.is_authenticated %}
	{% else %}
	<div class="ui-state-highlight ui-corner-all content">
	<p>Want to have a play around? Just <a href="/user/login">login</a> with the username 'demo' and password 'demo'. Nothing is guaranteed to work, but please email any problems you do find to <a href="mailto:bill@gibthon.org">me</a></p>
	</div>
	{% endif %}
	{% endblock %}
	
	{% block content %}{% endblock %}
	<div class="ui-widget-content ui-corner-all footer">
		Copyright 2011 Bill Collins and Contributors
	</div>
</div>

{% block dialog %}
{% endblock %}
<div id="prompt"></div>
<div id="prompt2"></div>
</body>
</html>
